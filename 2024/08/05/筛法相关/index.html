<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>筛法相关 | joke3579</title>
  <link rel="stylesheet" href="/css/fonts/Chinese-normal-normal.min.css">
  <link rel="stylesheet" href="/css/fonts/ChineseMono-normal-normal.min.css">
  <link rel="stylesheet" href="/css/fonts/Chinese-italic-normal.min.css">
  <link rel="stylesheet" href="/css/fonts/Chinese-normal-bold.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="杜教筛，贝尔级数，">
  
  
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox-1.3.4.css">
  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <div id="nav-outer">
  <nav id="main-nav" class="outer">
    <a id="main-nav-toggle" class="nav-icon"></a>
    
      <a class="main-nav-link" href="/">首页</a>
    
      <a class="main-nav-link" href="/archives">归档</a>
    
    <div class="main-nav-space-between"></div>
    
  </nav>
</div>
<div id="header-title">
  <h1 id="logo-wrap">
    <a href="/" id="logo">Dr. Zhow</a>
  </h1>
  
</div>

      <div id="content" class="outer">
        <section id="main"><article id="post-筛法相关" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/05/%E7%AD%9B%E6%B3%95%E7%9B%B8%E5%85%B3/" class="article-date">
  <time class="dt-published" datetime="2024-08-05T11:42:35.000Z" itemprop="datePublished">2024-08-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      筛法相关
    </h1>
  

      </header>
    
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="杜教筛">杜教筛</h1>
<p>首先这玩意的前置知识是 Dirichlet 卷积<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>记这个复合为 <span class="markdown-them-math-inline">$*$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>正常的点值乘法为 <span class="markdown-them-math-inline">$\times$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>其实推导式子是不用莫反的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>假设我们有一个积性函数 <span class="markdown-them-math-inline">$f$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>定义它的前缀和函数为 <span class="markdown-them-math-inline">$S(f, n) = \sum_{i=1}^n f(i)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>现在需要解决的是快速算出 <span class="markdown-them-math-inline">$S(f, n)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>由 duls 总结的杜教筛对一部分具有特殊性质的 <span class="markdown-them-math-inline">$f$</span> 提供了一种 <span class="markdown-them-math-inline">$O(n^{2/3})$</span> 时间复杂度的解决方案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>具体地<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们构造 <span class="markdown-them-math-inline">$g,h\text{ s.t. } h = f * g$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>假设我们容易对给定的多个 <span class="markdown-them-math-inline">$k \le n \text{ s.t. } \exists x, k = \left\lfloor \frac nx \right\rfloor$</span> 求得 <span class="markdown-them-math-inline">$S(g, k)$</span> 和 <span class="markdown-them-math-inline">$S(h, k)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们就可以应用杜教筛<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>杜教筛的推导如下<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<p>$$\begin{aligned}</p>
<p>S(h, n) &amp; = \sum_{x=1}^n h(x)<br>
\ &amp; = \sum_{x = 1}^n \sum_{d|x} g(d) f(\frac xd)<br>
\ &amp; = \sum_{d = 1}^n g(d) \sum_{x = 1}^{\left\lfloor \frac n d \right\rfloor} f(x)<br>
\ &amp; = \sum_{d = 1}^n g(d) S(f, \left\lfloor \frac n d \right\rfloor)<br>
\ &amp; = g(1) S(f, n) + \sum_{d = 2}^n g(d) S(f, \left\lfloor \frac n d \right\rfloor)<br>
\ g(1) S(f, n) &amp; = S(h, n) - \sum_{d = 2}^n g(d) S(f, \left\lfloor \frac n d \right\rfloor)<br>
\ S(f, n) &amp; = \frac{1}{g(1)} \left( S(h, n) - \sum_{d = 2}^n g(d) S(f, \left\lfloor \frac n d \right\rfloor) \right)</p>
<p>\end{aligned}$$</p>
<p>所以就可以按照上面的方式递归了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>！</h-inner></h-char><h-char class="bd bd-end"><h-inner>（</h-inner></h-char></span>一般 <span class="markdown-them-math-inline">$g(1)$</span> 是 <span class="markdown-them-math-inline">$1$</span> 所以可以忽略<span class="bd-box"><h-char class="bd bd-beg"><h-inner>）</h-inner></h-char></span></p>
<p>那复杂度是多少呢<span class="bd-box"><h-char class="bd bd-beg"><h-inner>？</h-inner></h-char></span>应用<a target="_blank" rel="noopener" href="https://www.cnblogs.com/joke3579/p/paperessay221204.html#-%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6">分析 <span class="markdown-them-math-inline">$Min25$</span> 筛时用到的渐进方式</a>可以得到</p>
<p>$$\begin{aligned}</p>
<p>&amp; \sum_{i=1}^{\sqrt n} O(\sqrt i) + \sum_{i=1}^{\sqrt n} O(\sqrt \frac ni)<br>
\ = \ &amp; O\left(\int_{1}^{\sqrt n} x^{\frac 12} \text dx\right) + O\left(\int_{1}^{\sqrt n} (\frac n x)^{\frac 12} \text dx\right)<br>
\ = \ &amp; O\left(n^{3/4} \right) + O\left(n^{3/4} \right)</p>
<p>\end{aligned}$$</p>
<p>因此不预处理的复杂度是 <span class="markdown-them-math-inline">$O\left(n^{3/4} \right)$</span> 的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>这里默认记忆化了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>欸你刚才不是说 <span class="markdown-them-math-inline">$2/3$</span> 吗<span class="bd-box"><h-char class="bd bd-beg"><h-inner>？</h-inner></h-char></span>咋变慢了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>？</h-inner></h-char></span><br>
别着急<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>现在考虑预处理<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>我们预处理前 <span class="markdown-them-math-inline">$B$</span> 个位置的值<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>且有 <span class="markdown-them-math-inline">$B \ge \sqrt n$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>复杂度就变成了<br>
$$\begin{aligned}</p>
<p>\sum_{i=B}^{\sqrt n} O(\sqrt \frac ni) = O\left(\frac{n}{\sqrt B}\right)</p>
<p>\end{aligned}$<span class="markdown-them-math-inline">$
取 $</span>B = n^{2/3}<span class="markdown-them-math-inline">$ 得到总时间复杂度 $</span>O(n^{2/3})$<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>总结一下<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>杜教筛是一类特殊的递归方案<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>我们首先选取两个易求前缀和的函数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>随后将所求函数 <span class="markdown-them-math-inline">$f$</span> 的前 <span class="markdown-them-math-inline">$n^{2/3}$</span> 个点值求出来<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>做前缀和<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>最后记忆化递归<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>在过程中模拟如上的式子就能得到最终答案了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span><br>
还发现<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>由于杜教筛的记忆化性质<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>其可以在一次求解中得到 <span class="markdown-them-math-inline">$n$</span> 对应 <span class="markdown-them-math-inline">$O(\sqrt n)$</span> 个数论分块点值处的前缀和<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>因此其时间复杂度应当均摊分析<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>用于数论分块中时总复杂度没有退化<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span><br>
重复式子<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>构造 <span class="markdown-them-math-inline">$g,h\text{ s.t. } h = f * g$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><br>
<div class="markdown-them-math-block">$$S(f, n) = \frac{1}{g(1)} \left( S(h, n) - \sum_{d = 2}^n g(d) S(f, \left\lfloor \frac n d \right\rfloor) \right)$$</div></p>
<p>给出几个常见的数论函数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<ul>
<li>欧拉函数 <span class="markdown-them-math-inline">$\varphi(n) = \sum_{(d,n) =1} 1$</span></li>
<li>莫比乌斯函数 <span class="markdown-them-math-inline">$\mu(n)$</span></li>
<li>恒等函数 <span class="markdown-them-math-inline">$\text I(n) = 1$</span></li>
<li>元函数 <span class="markdown-them-math-inline">$e(n) = [n = 1]$</span></li>
<li>单位函数 <span class="markdown-them-math-inline">$\text{id} (n) = n$</span></li>
<li>约数个数函数 <span class="markdown-them-math-inline">$\text{d} (n) = \sum_{d | n} 1$</span></li>
<li>题面里给的函数 <span class="markdown-them-math-inline">$f(n) = \small{我怎么知道}$</span></li>
</ul>
<p>这里记 <span class="markdown-them-math-inline">$k$</span> 个数论函数 <span class="markdown-them-math-inline">$f$</span> 卷起来的函数为 <span class="markdown-them-math-inline">$f_k$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>给出几个常见的构造<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span></p>
<ul>
<li><span class="markdown-them-math-inline">$\mu * \text I = e \ \to \ f = (f * \text I) * \mu \ $</span> 该变换即莫比乌斯反演<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></li>
<li><span class="markdown-them-math-inline">$\varphi * \text I = \text {id}\ \to \ \text{id} * \mu = \varphi$</span></li>
<li><span class="markdown-them-math-inline">$\text{id} * \text{id} = \text{id} \times \text d$</span></li>
</ul>
<p>结合例题来理解吧<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<h2 id="例题">例题</h2>
<p>首先是板子<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4213"><span class="bd-box"><h-char class="bd bd-end"><h-inner>【</h-inner></h-char></span>模板<span class="bd-box"><h-char class="bd bd-beg"><h-inner>】</h-inner></h-char></span>杜教筛</a></p>
<p>给定正整数 <span class="markdown-them-math-inline">$n$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求 <span class="markdown-them-math-inline">$S(\varphi, n)$</span> 与 <span class="markdown-them-math-inline">$S(\mu, n)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><span class="markdown-them-math-inline">$n \le 10^{11}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</blockquote>
<p>照上式模拟即可<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>具体看代码<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<details>
<summary>code</summary>
<div class="highlight"><pre class="code"><code><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> int long long</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> rep(i,a,b) for ( register int (i) = (a); (i) &lt;= (b); ++(i) )</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> pre(i,a,b) for ( register int (i) = (a); (i) &gt;= (b); --(i) )</span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">5e6</span> + <span class="hljs-number">10</span>, L = <span class="hljs-number">5e6</span>;
<span class="hljs-keyword">int</span> T, n;

<span class="hljs-keyword">int</span> prime[N], cnt, phi[N], mu[N];
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">sieve</span><span class="hljs-params">()</span> </span>&#123;
    phi[<span class="hljs-number">1</span>] = mu[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;
    <span class="hljs-built_in">rep</span>(i,<span class="hljs-number">2</span>,L) &#123;
        <span class="hljs-keyword">if</span> (phi[i] == <span class="hljs-number">0</span>) prime[++cnt] = i, phi[i] = i - <span class="hljs-number">1</span>, mu[i] = - <span class="hljs-number">1</span>;
        <span class="hljs-built_in">rep</span>(j,<span class="hljs-number">1</span>,cnt) &#123;
            <span class="hljs-keyword">int</span> tmp = i * prime[j];
            <span class="hljs-keyword">if</span> (tmp &gt; L) <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">if</span> (i % prime[j] == <span class="hljs-number">0</span>) &#123;
                phi[tmp] = prime[j] * phi[i]; mu[tmp] = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">break</span>;
            &#125; <span class="hljs-keyword">else</span> 
                phi[tmp] = phi[prime[j]] * phi[i]; mu[tmp] = -mu[i];
        &#125;
    &#125; 
	<span class="hljs-built_in">rep</span>(i,<span class="hljs-number">2</span>,L) phi[i] = phi[i<span class="hljs-number">-1</span>] + phi[i], mu[i] = mu[i<span class="hljs-number">-1</span>] + mu[i];
&#125;

<span class="hljs-keyword">int</span> _phi[N], _mu[N];
<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPhi</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;
	<span class="hljs-keyword">if</span> (x &lt;= L) <span class="hljs-keyword">return</span> phi[x];
	<span class="hljs-keyword">if</span> (~_phi[n / x]) <span class="hljs-keyword">return</span> _phi[n / x];
	<span class="hljs-keyword">int</span> ret = <span class="hljs-number">1ll</span> * x * (x + <span class="hljs-number">1</span>) &gt;&gt; <span class="hljs-number">1</span>;
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> l = <span class="hljs-number">2</span>, r; l &lt;= x; l = r+<span class="hljs-number">1</span>) &#123;
		r = x / ( x / l );
		ret -= (r - l + <span class="hljs-number">1</span>) * <span class="hljs-built_in">getPhi</span>(x / l);
	&#125; 
	<span class="hljs-keyword">return</span> _phi[n / x] = ret;
&#125;

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getMu</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;
	<span class="hljs-keyword">if</span> (x &lt;= L) <span class="hljs-keyword">return</span> mu[x];
	<span class="hljs-keyword">if</span> (~_mu[n / x]) <span class="hljs-keyword">return</span> _mu[n / x];
	<span class="hljs-keyword">int</span> ret = <span class="hljs-number">1</span>;
	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> l = <span class="hljs-number">2</span>, r; l &lt;= x; l = r + <span class="hljs-number">1</span>) &#123;
		r = x / ( x / l );
		ret -= (r - l + <span class="hljs-number">1</span>) * <span class="hljs-built_in">getMu</span>(x / l);
	&#125; 
	<span class="hljs-keyword">return</span> _mu[n / x] = ret;
&#125;

<span class="hljs-function"><span class="hljs-keyword">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;
	<span class="hljs-built_in">sieve</span>(); cin &gt;&gt; T;
	<span class="hljs-keyword">while</span> (T--) &#123;
		cin &gt;&gt; n;
		<span class="hljs-built_in">memset</span>(_phi, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span> _phi);
		<span class="hljs-built_in">memset</span>(_mu, <span class="hljs-number">-1</span>, <span class="hljs-keyword">sizeof</span> _mu);
		cout &lt;&lt; <span class="hljs-built_in">getPhi</span>(n) &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span> &lt;&lt; <span class="hljs-built_in">getMu</span>(n) &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span>;
	&#125; 
&#125;
</code></pre></div>
</details>
<p><a href=""></a><br>
<a href=""></a></p>
<hr>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://loj.ac/p/6491">简单的最大公约数</a></p>
<p>给定 <span class="markdown-them-math-inline">$n,k$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求</p>
<p><div class="markdown-them-math-block">$$\sum^k_{a_1=1}\sum^k_{a_2=1}\sum^k_{a_3=1}\dots\sum^k_{a_n=1}\gcd(a_1,a_2,a_3,\dots,a_n)\pmod{ 1000000007}$$</div></p>
<p><span class="markdown-them-math-inline">$n,k \le 10^{11}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/joke3579/p/chitchat221107.html">这里是早就写好了的题解</a><span class="bd-box"><h-char class="bd bd-beg"><h-inner>！</h-inner></h-char></span></p>
<p><a href=""></a><br>
<a href=""></a></p>
<hr>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://darkbzoj.cc/problem/3512">DZY Loves Math IV</a></p>
<p>给定 <span class="markdown-them-math-inline">$n,m$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求</p>
<p><div class="markdown-them-math-block">$$\sum_{i=1}^n \sum_{j=1}^m \varphi(ij) \pmod{1000000007}$$</div></p>
<p><span class="markdown-them-math-inline">$n \le 10^5, m \le 10^9$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</blockquote>
<p>考虑 <span class="markdown-them-math-inline">$n$</span> 比较小<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>我们可以对每个 <span class="markdown-them-math-inline">$n$</span> 计算答案后求和<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>现在的问题是求解<br>
<div class="markdown-them-math-block">$$S(n, m) = \sum_{i=1}^m \varphi(in)$$</div></p>
<p>假设 <span class="markdown-them-math-inline">$n = pq$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>其中 <span class="markdown-them-math-inline">$p$</span> 是将 <span class="markdown-them-math-inline">$n$</span> 的所有质因子拿出一个来求积的得数<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>我们有<br>
$$\begin{aligned}</p>
<p>S(n, m) &amp; \ = \sum_{i=1}^m \varphi(in)<br>
\ &amp; \ = q\sum_{i=1}^m \varphi(ip)<br>
\ &amp; \ = q\sum_{i=1}^m \varphi(\frac{p}{\gcd(i, p)}) \varphi(i) \gcd(i, p)<br>
\ &amp; \ = q\sum_{i=1}^m \varphi(\frac{p}{\gcd(i, p)}) \varphi(i) \sum_{d|(i, p)} \varphi(d) \qquad &amp; (\varphi * \text{I} = \text{id} )<br>
\ &amp; \ = q\sum_{i=1}^m \varphi(i) \sum_{d|(i, p)} \varphi\left(\frac{dp}{\gcd(i, p)} \right)\qquad &amp; (\varphi 是积性的)<br>
\ &amp; \ = q\sum_{i=1}^m \varphi(i) \sum_{d|(i, p)} \varphi\left(\frac{p}{d} \right)<br>
\ &amp; \ = q\sum_{d|p} \varphi\left(\frac{p}{d} \right)\sum_{i=1}^{m / d} \varphi(id)<br>
\ &amp; \ = q\sum_{d|p} \varphi\left(\frac{p}{d} \right) S(d, \left\lfloor\frac md\right\rfloor)</p>
<p>\end{aligned}$$</p>
<p>递归计算即可<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>边界不再赘述<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>由于最终是 <span class="markdown-them-math-inline">$\left\lfloor\frac md\right\rfloor$</span> 的形式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>所以第二维的取值数是 <span class="markdown-them-math-inline">$O(n\sqrt m)$</span> 的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>每一层要枚举的总状态数是<span class="markdown-them-math-inline">$O(\sqrt n)$</span> 的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>因此这一部分的复杂度是 <span class="markdown-them-math-inline">$O(n(\sqrt n + \sqrt m))$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>考虑杜教筛的记忆化形式<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>边界本质上只需要进行一次杜教筛即可全部求出来<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>因此总时间复杂度为 <span class="markdown-them-math-inline">$O(n(\sqrt n + \sqrt m) + m^{2/3})$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span><br>
理论复杂度能跑 <span class="markdown-them-math-inline">$10^{11}$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>本机 O2 加持下跑了 1.61s<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><a target="_blank" rel="noopener" href="https://darkbzoj.cc/submission/222627">Submission</a><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><a href=""></a><br>
<a href=""></a></p>
<hr>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://darkbzoj.cc/problem/4916">神犇和蒟蒻</a></p>
<p>给定 <span class="markdown-them-math-inline">$n,m$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求</p>
<p><div class="markdown-them-math-block">$$\sum_{i=1}^n \mu(i^2) \qquad \sum_{i=1}^n \varphi(i^2)$$</div></p>
<p><span class="markdown-them-math-inline">$n \le 10^9$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</blockquote>
<p>没啥<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>放这题就是整点水清凉一下<span class="bd-box"><h-char class="bd bd-end"><h-inner>（</h-inner></h-char></span></p>
<p><span class="markdown-them-math-inline">$\mu$</span> 那个显然答案就是 <span class="markdown-them-math-inline">$1$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span><br>
<span class="markdown-them-math-inline">$\varphi$</span>……哦想起来了<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>放这题是因为想告诉你们 <span class="markdown-them-math-inline">$\varphi(n^k) = n^{k-1}\varphi(n)$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>挺好用的<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><span class="markdown-them-math-inline">$f(n) = \varphi(n) \times n$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span><span class="markdown-them-math-inline">$f * \text{id} = \text{id}_2$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span>剩下的看代码<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><a target="_blank" rel="noopener" href="https://darkbzoj.cc/submission/222637">Submission</a><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><a href=""></a><br>
<a href=""></a></p>
<hr>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://darkbzoj.cc/problem/4176">Lucas的数论</a></p>
<p>给定 <span class="markdown-them-math-inline">$n$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>求</p>
<p><div class="markdown-them-math-block">$$\sum_{i=1}^n \sum_{j=1}^n \text d(ij) \pmod{1000000007}$$</div></p>
<p><span class="markdown-them-math-inline">$n \le 10^9$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
</blockquote>
<p>还记得 约数个数和 那题吗<span class="bd-box"><h-char class="bd bd-beg"><h-inner>？</h-inner></h-char></span><br>
直接套那个式子</p>
<p>$$\begin{aligned}</p>
<p>&amp;\sum_{i=1}^n \sum_{j=1}^n \text d(ij)<br>
\ = &amp; \ \sum_{i=1}^n \sum_{j=1}^n \sum_{x|i} \sum_{y|j} [gcd(x, y) = 1]<br>
\ = &amp; \ \sum_{i=1}^n \sum_{j=1}^n \sum_{x|i} \sum_{y|j} \sum_{d|(x, y)}\mu(d)<br>
\ = &amp; \ \sum_{x = 1} \sum_{y = 1} \sum_{d|(x, y)}\mu(d) \left\lfloor \frac n{x} \right\rfloor \left\lfloor \frac n{y} \right\rfloor<br>
\ = &amp; \ \sum_{d = 1}\mu(d) \sum_{x = 1} \left\lfloor \frac n{xd} \right\rfloor \sum_{y = 1} \left\lfloor \frac n{yd} \right\rfloor</p>
<p>\end{aligned}$$</p>
<p>然后对 <span class="markdown-them-math-inline">$d$</span> 进行数论分块<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>对 <span class="markdown-them-math-inline">$\mu$</span> 采用杜教筛<span class="bd-box"><h-char class="bd bd-beg"><h-inner>，</h-inner></h-char></span>对 <span class="markdown-them-math-inline">$x,y$</span> 采用二次数论分块<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p>根据<a target="_blank" rel="noopener" href="https://www.cnblogs.com/CDOI-24374/p/16531615.html#%E6%9D%A8%E5%8D%93%E5%87%A1%E7%AC%AC%E4%B8%80%E5%B0%8F%E5%AE%9A%E7%90%86">杨卓凡第一小定理(?)</a>可知总时间复杂度为 <span class="markdown-them-math-inline">$O(n^{3/4})$</span><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<p><a target="_blank" rel="noopener" href="https://darkbzoj.cc/submission/222641">Submission</a><span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<hr>
<p>留着别的题明天写吧<span class="bd-box"><h-char class="bd bd-beg"><h-inner>。</h-inner></h-char></span></p>
<hr>
<p>upd: <a target="_blank" rel="noopener" href="https://www.cnblogs.com/CDOI-24374/p/18017310">对杜教筛的巨大常数优化<span class="bd-box"><h-char class="bd bd-beg"><h-inner>：</h-inner></h-char></span>非递归</a></p>
<details>
<summary>模板题实现</summary>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/record/147291329">Submission</a>.</p>
<div class="highlight"><pre class="code"><code><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> inline __attribute__((__gnu_inline__, __always_inline__, __artificial__)) inline</span>
<span class="hljs-keyword">using</span> pii = pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;; <span class="hljs-keyword">using</span> vi = vector&lt;<span class="hljs-keyword">int</span>&gt;; <span class="hljs-keyword">using</span> vp = vector&lt;pii&gt;; <span class="hljs-keyword">using</span> ll = <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>; 
<span class="hljs-keyword">using</span> ull = <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span>; <span class="hljs-keyword">using</span> db = <span class="hljs-keyword">double</span>; <span class="hljs-keyword">using</span> ld = <span class="hljs-keyword">long</span> <span class="hljs-keyword">double</span>; <span class="hljs-keyword">using</span> lll = <span class="hljs-keyword">__int128_t</span>;
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T1, <span class="hljs-keyword">typename</span> T2&gt; T1 <span class="hljs-title">max</span><span class="hljs-params">(T1 a, T2 b)</span> </span>&#123; <span class="hljs-keyword">return</span> a &gt; b ? a : b; &#125;
<span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T1, <span class="hljs-keyword">typename</span> T2&gt; T1 <span class="hljs-title">min</span><span class="hljs-params">(T1 a, T2 b)</span> </span>&#123; <span class="hljs-keyword">return</span> a &lt; b ? a : b; &#125;
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> multi int _T_; cin &gt;&gt; _T_; for (int TestNo = 1; TestNo &lt;= _T_; ++ TestNo)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> timer cerr &lt;&lt; 1. * clock() / CLOCKS_PER_SEC &lt;&lt; <span class="hljs-meta-string">&#x27;\n&#x27;</span>;</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> iot ios::sync_with_stdio(false), cin.tie(0), cout.tie(0);</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> file(x) freopen(#x<span class="hljs-meta-string">&quot;.in&quot;</span>, <span class="hljs-meta-string">&quot;r&quot;</span>, stdin), freopen(#x<span class="hljs-meta-string">&quot;.out&quot;</span>, <span class="hljs-meta-string">&quot;w&quot;</span>, stdout)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> rep(i,s,t) for (register int i = (s), i##_ = (t) + 1; i &lt; i##_; ++ i)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> pre(i,s,t) for (register int i = (s), i##_ = (t) - 1; i &gt; i##_; -- i)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> eb emplace_back</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> pb pop_back</span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">4e6</span> + <span class="hljs-number">10</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> inf = <span class="hljs-number">0x3f3f3f3f</span>;
<span class="hljs-keyword">const</span> ll infll = <span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>ll;
ll n, th, mp[N], lp[N], ilp[N], lv[N], cntl;
ll phimp[N], mump[N];
<span class="hljs-keyword">int</span> T[N], cT;
db iv[N];

ll phi[N], mu[N], pri[N], cntp;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sieve</span><span class="hljs-params">(<span class="hljs-keyword">int</span> N)</span> </span>&#123;
    phi[<span class="hljs-number">1</span>] = mu[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;
    <span class="hljs-built_in">rep</span>(i,<span class="hljs-number">2</span>,N) &#123;
        <span class="hljs-keyword">if</span> (!phi[i]) pri[++ cntp] = i, phi[i] = i - <span class="hljs-number">1</span>, mu[i] = <span class="hljs-number">-1</span>;
        <span class="hljs-built_in">rep</span>(j,<span class="hljs-number">1</span>,cntp) &#123;
            <span class="hljs-keyword">if</span> (i * pri[j] &gt; N) <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">if</span> (i % pri[j] == <span class="hljs-number">0</span>) &#123;
                phi[i * pri[j]] = phi[i] * pri[j], mu[i * pri[j]] = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">break</span>;
            &#125; <span class="hljs-keyword">else</span> &#123;
                phi[i * pri[j]] = phi[i] * (pri[j] - <span class="hljs-number">1</span>), mu[i * pri[j]] = - mu[i];
            &#125;
        &#125;
    &#125;
    <span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,N) phi[i] += phi[i - <span class="hljs-number">1</span>], mu[i] += mu[i - <span class="hljs-number">1</span>];
&#125;

<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> Sid(n) (1ll * (n) * ((n) + 1) / 2)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SI(n) (n)</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> Se(n) (1)</span>

<span class="hljs-function"><span class="hljs-keyword">signed</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>&#123;
    cin &gt;&gt; cT;
    <span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,cT) cin &gt;&gt; T[i], n = <span class="hljs-built_in">max</span>(n, T[i]);
    th = <span class="hljs-built_in">min</span>(N - <span class="hljs-number">5</span>, (<span class="hljs-keyword">int</span>)<span class="hljs-built_in">pow</span>(n, <span class="hljs-number">2.</span>/<span class="hljs-number">3</span>));
    <span class="hljs-built_in">sieve</span>(th);
    <span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,(<span class="hljs-keyword">int</span>)<span class="hljs-built_in">sqrt</span>(n)) iv[i] = <span class="hljs-number">1.</span> / i;
    <span class="hljs-comment">// cerr &lt;&lt; (ll)(1e10) / 10000 &lt;&lt; &#x27; &#x27; &lt;&lt; iv[10000] &lt;&lt; &#x27; &#x27; &lt;&lt; (int)((ll)(1e10) * iv[10000]) &lt;&lt; endl;</span>
    <span class="hljs-built_in">rep</span>(i,<span class="hljs-number">1</span>,cT) &#123;
        n = T[i];
        <span class="hljs-keyword">if</span> (n &lt;= th) &#123;
            cout &lt;&lt; phi[n] &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span> &lt;&lt; mu[n] &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span>;
            <span class="hljs-keyword">continue</span>;
        &#125;
        cntl = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (ll l = <span class="hljs-number">1</span>, r; n / l &gt; th; l = r + <span class="hljs-number">1</span>) &#123;
            r = n / (n / l);
            mp[lp[++ cntl] = l] = n / l;
            <span class="hljs-built_in">rep</span>(i,l,r) lv[i] = l;
        &#125;
        <span class="hljs-built_in">pre</span>(i,cntl,<span class="hljs-number">1</span>) &#123;
            ll nc = mp[lp[i]], sqnc = (<span class="hljs-keyword">int</span>)<span class="hljs-built_in">sqrt</span>(nc);
            phimp[i] = <span class="hljs-built_in">Sid</span>(nc) + <span class="hljs-number">1ll</span> * <span class="hljs-built_in">SI</span>(sqnc) * phi[sqnc];
            mump[i] = <span class="hljs-built_in">Se</span>(nc) + <span class="hljs-number">1ll</span> * <span class="hljs-built_in">SI</span>(sqnc) * mu[sqnc];
            <span class="hljs-built_in">rep</span>(j,<span class="hljs-number">1</span>,sqnc) &#123;
                <span class="hljs-keyword">int</span> it = <span class="hljs-built_in"><span class="hljs-keyword">int</span></span>(nc * iv[j] + <span class="hljs-number">1e-8</span>); <span class="hljs-comment">// 警钟敲烂&lt;span class=&quot;bd-box&quot;&gt;&lt;h-char class=&quot;bd bd-beg&quot;&gt;&lt;h-inner&gt;：&lt;/h-inner&gt;&lt;/h-char&gt;&lt;/span&gt;如果 nc mod j = 0 则需要 + eps 防丢精</span>
                phimp[i] -= <span class="hljs-number">1ll</span> * (phi[j] - phi[j - <span class="hljs-number">1</span>]) * <span class="hljs-built_in">SI</span>(it);
                mump[i] -= <span class="hljs-number">1ll</span> * (mu[j] - mu[j - <span class="hljs-number">1</span>]) * <span class="hljs-built_in">SI</span>(it);
                <span class="hljs-keyword">if</span> (j &gt; <span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> (it &lt;= th) &#123;
                    phimp[i] -= phi[it];
                    mump[i] -= mu[it];
                &#125; <span class="hljs-keyword">else</span> &#123;
                    phimp[i] -= phimp[lv[lp[i] * j]];
                    mump[i] -= mump[lv[lp[i] * j]];
                &#125;
            &#125;
            <span class="hljs-comment">// cerr &lt;&lt; &quot;Partial answer : &quot; &lt;&lt; nc &lt;&lt; &#x27; &#x27; &lt;&lt; sqnc &lt;&lt; &#x27; &#x27; &lt;&lt; phimp[i] &lt;&lt; &#x27; &#x27; &lt;&lt; mump[i] &lt;&lt; endl;</span>
        &#125; 

        cout &lt;&lt; phimp[<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-string">&#x27; &#x27;</span> &lt;&lt; mump[<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-string">&#x27;\n&#x27;</span>;
    &#125;
&#125;
</code></pre></div>
</details>
      
    </div>
    <footer class="article-footer">
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2024/08/05/%E6%A6%82%E7%8E%87%E5%AF%86%E5%BA%A6%E6%89%A9%E5%85%85%E7%8A%B6%E6%80%81%E7%9A%84%E4%B8%80%E4%B8%AA%E5%B0%9D%E8%AF%95/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          概率密度扩充状态的一个尝试
        
      </div>
    </a>
  
</nav>

  
</article>


</section>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      Copyright &copy; 2024 joke3579<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a><br>
      
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">归档</a>
  
</nav>
    

<script src="/js/clipboard.min.js"></script>
<script src="/js/jquery-1.4.3.min.js"></script>

<script src="/fancybox/jquery.fancybox-1.3.4.pack.js"></script>


<script src="/js/script.js"></script>






<script>
  MathJax = {
    options: {
      enableMenu: false
    },
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
    }
  };
</script>
<!-- <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]},
    CommonHTML: {
      linebreaks: false
    }
  });
  </script> -->
<script type="text/javascript" id="MathJax-script" async
  src="/mathjax/tex-chtml.js">
</script>
<!-- <script type="text/javascript"
   src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS_CHTML">
</script> -->

  </div>
</body>
</html>